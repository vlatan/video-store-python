{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/post.css') }}">
{% endblock css %}

{% block content %}
<article class="media-content">
	<div class="video-content">
		<div class="player">
			<div class="player-content" id="{{ post.video_id }}">
				<img alt="{{ post.title }}" src="{{ thumb }}">
				<div class="play"></div>
			</div>
		</div>

		<header class="metadata">
			<h1 class="video-title">{{ post.title }}</h1>
			<div class="other-metadata">
				<div class="metadata-block">
					<div class="video-duration">
						Duration: {{ duration }}
					</div>
					{% if current_user.is_authenticated and current_user.is_admin %}
					<button data-modal="video" class="modal-button">Delete</button>
					{% endif %}
				</div>
				<div class="social">
					<div class="likes">
						{% if current_user.is_authenticated %}
						{% if current_user.has_casted(post, 'like') %}
						<button class="like like-yes like-counter">{{ likes }}</button>
						{% else %}
						<button class="like like-no like-counter">{{ likes }}</button>
						{% endif %}
						{% else %}
						<button data-auth class="like like-no">{{ likes }}</button>
						{% endif %}
					</div>

					<div class="faves">
						{% if current_user.is_authenticated %}
						{% if current_user.has_casted(post, 'fave') %}
						<button class="fave fave-yes fave-status">Saved</button>
						{% else %}
						<button class="fave fave-no fave-status">Save</button>
						{% endif %}
						{% else %}
						<button data-auth class="fave fave-no">Save</button>
						{% endif %}
					</div>
				</div>
			</div>
		</header>
	</div>

	<div class="related_videos">
		{% if post.related_posts %}
		{% for related_post in post.related_posts %}
		{% set thumb = related_post.thumbnails['medium'] %}
		<a href="{{ url_for('posts.post', post_id=related_post.id) }}" class="related-video">
			<img class="related-img" src="{{ thumb['url'] }}" width="{{ thumb['width'] }}"
				height="{{ thumb['height'] }}" alt="{{ related_post.title }}">
			<h2 class="related-post-title">
				{{ related_post.title }}
			</h2>
		</a>
		{% endfor %}
		{% endif %}
	</div>
</article>

{% if current_user.is_authenticated and current_user.is_admin %}
<div data-body="video" class="modal">
	<form class="modal-content" action="{{ url_for('posts.perform_action', post_id=post.id, action='delete') }}"
		method="POST">
		<span data-close="video" class="close-modal" title="Close">&times;</span>
		<h2>Delete Video</h2>
		<p>Are you sure you want to delete this video?</p>
		<div class="modal-buttons-wrap">
			<button data-close="video" type="button" class="modal-button cancel-button">Cancel</button>
			<button type="submit" class="modal-button delete-button">Delete</button>
		</div>
	</form>
</div>
{% endif %}
{% endblock content %}

{% block scripts %}
{% if current_user.is_authenticated %}
<script async defer src="{{ url_for('static', filename='js/likes.js') }}"></script>
{% else %}
<script async defer src="{{ url_for('static', filename='js/login.js') }}"></script>
{% endif %}
<script async defer src="{{ url_for('static', filename='js/play.js') }}"></script>
{% endblock scripts %}